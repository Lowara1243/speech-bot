[English](README.md) | [Русский](README.ru.md)
---

# Speech-to-Text Telegram Bot

Телеграм-бот для преобразования голосовых сообщений и аудиофайлов в текст с помощью модели OpenAI Whisper.

## Оглавление
- [Основные возможности](#основные-возможности)
- [Быстрый старт (Docker)](#быстрый-старт-docker)
- [Установка из исходного кода](#установка-из-исходного-кода)
- [Конфигурация](#конфигурация)
- [Управление ботом](#управление-ботом)

## Основные возможности

-   Распознавание речи из голосовых сообщений.
-   Гибкая система лимитов (ежедневно, еженедельно, ежемесячно).
-   Настраиваемое устройство для обработки (`CPU`/`GPU`).
-   Готов к развертыванию с помощью Docker.

## Быстрый старт (Docker)

Это рекомендуемый способ для быстрого развертывания.

**1. Подготовьте окружение**

Создайте необходимые директории и файл конфигурации `.env`:

```bash
mkdir -p data audio logs && touch .env
```

**2. Настройте `.env`**

Скопируйте содержимое ниже в ваш `.env` файл и **замените значения `BOT_TOKEN` и `ADMIN_ID`**.

```env
# Обязательные параметры
BOT_TOKEN=12345:your_telegram_bot_token_here
ADMIN_ID=123456789

# Необязательные параметры (можно оставить по умолчанию)
DB_FILENAME=users.db
MODEL_NAME=base
TRANSCRIPTION_DEVICE=cpu
UPDATE_TIME_POLICY=AFTER
RESET_SCHEDULE=DAILY
LOG_LEVEL=INFO
```
> Подробное описание всех переменных смотрите в разделе [Конфигурация](#конфигурация).

**3. Запустите контейнер**

Выполните команду в той же папке, где находится ваш `.env` файл:

```bash
docker run -d \
  --name speech-bot \
  --rm \
  --env-file .env \
  -v "$(pwd)/data":/app/data \
  -v "$(pwd)/audio":/app/audio \
  -v "$(pwd)/logs":/app/logs \
  docker.io/Lowara1243/speech-bot:latest
```
> **Для Windows:** В Command Prompt замените `$(pwd)` на `%cd%`, в PowerShell — на `${PWD}`.

**Бот запущен!**

## Установка из исходного кода

<details>
<summary>Нажмите, чтобы развернуть инструкцию по ручной установке</summary>

Этот способ подходит для разработки или если вы не хотите использовать Docker.

**1. Клонируйте репозиторий**
```bash
git clone https://github.com/Lowara1243/speech-bot.git
cd speech-bot
```

**2. Создайте виртуальное окружение и установите зависимости**

Выберите один из способов:

*   **С помощью `uv` (рекомендуется):**
    ```bash
    # Создаст .venv и установит зависимости
    uv pip install -r requirements.txt
    ```
*   **С помощью `pip`:**
    ```bash
    python -m venv venv
    pip install -r requirements.txt
    ```

**3. Активируйте окружение**

*   **macOS / Linux:** `source .venv/bin/activate` (или `venv/` если использовали `pip`)
*   **Windows:** `.venv\Scripts\activate` (или `venv\`)

**4. Настройте переменные окружения**

Скопируйте `.env.example` в `.env` и заполните его своими значениями.
```bash
cp .env.example .env
```
> Описание всех переменных смотрите в разделе [Конфигурация](#конфигурация).

**5. Запустите бота**
```bash
python main.py
```

</details>

## Конфигурация

Бот настраивается через переменные окружения (в файле `.env` или напрямую).

| Переменная             | Описание                                                                                      | Значение по умолчанию |
|------------------------|-----------------------------------------------------------------------------------------------|-----------------------|
| `BOT_TOKEN`            | **(Обязательно)** Токен Telegram-бота, полученный от [@BotFather](https://t.me/BotFather).    | -                     |
| `ADMIN_ID`             | **(Обязательно)** Telegram User ID администратора. Администратор имеет неограниченные лимиты. | -                     |
| `DB_FILENAME`          | Имя файла базы данных SQLite. Будет создан в папке `data/`.                                   | `users.db`            |
| `MODEL_NAME`           | Модель Whisper: `tiny`, `base`, `small`, `medium`, `large`, `turbo`.                          | `base`                |
| `TRANSCRIPTION_DEVICE` | Устройство для обработки: `cpu` или `cuda` (`gpu`).                                           | `cpu`                 |
| `UPDATE_TIME_POLICY`   | Когда обновлять использованное время: `BEFORE` (до) или `AFTER` (после) транскрибации.        | `AFTER`               |
| `RESET_SCHEDULE`       | Как часто сбрасывать лимиты: `DAILY`, `WEEKLY`, `MONTHLY`.                                    | `DAILY`               |
| `LOG_LEVEL`            | Уровень логирования: `INFO`, `DEBUG`, `WARNING`, `ERROR`.                                     | `INFO`                |


## Управление ботом

- **Просмотр логов (Docker):** `docker logs -f speech-bot`
- **Остановка бота (Docker):** `docker stop speech-bot`
